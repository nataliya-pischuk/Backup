# 12.8 Резервное копирование баз данных
### Задание 1
1.Необходимо описать, какие варианты резервного копирования подходят в случаях:

1.1. Необходимо восстанавливать данные в полном объёме за предыдущий день.

1.2. Необходимо восстанавливать данные за час до предполагаемой поломки.

1.3.* Возможен ли кейс, когда при поломке базы происходило моментальное переключение на работающую или починенную базу данных.

Приведите ответ в свободной форме.

### Ответ
Все эти методы можно комбинировать для достижения оптимального баланса между стоимостью, скоростью восстановления и надёжностью системы. Рекомендуется провести детальный анализ требований и выбрать наиболее подходящий вариант с учётом специфики работы финансовой компании

1.1. Восстановление данных за предыдущий день
- Ежедневное полное резервное копирование — создание полной копии всех данных на конец рабочего дня. Подходит для восстановления полной базы данных за сутки.
- Еженедельное инкрементальное копирование — ежедневное создание инкрементов к полной копии. Позволяет восстановить данные за любой день недели.
- Резервное копирование с дедупликацией — оптимизация хранения за счёт удаления дубликатов данных. Экономично при сохранении возможности полного восстановления.

1.2. Восстановление данных за час до предполагаемой поломки
- Часовое резервное копирование (snapshot) — создание моментальных снимков базы данных каждые 60 минут. Обеспечивает точное восстановление состояния на конкретный момент времени.
- Журналирование изменений — запись всех изменений в базе данных в реальном времени. Позволяет восстановить состояние базы на любой момент в течение часа.
- Репликация с задержкой — настройка репликации с задержкой в 1 час. При сбое можно переключиться на реплику.

1.3. Моментальное переключение на работающую базу данных
- Hot Spare (горячий резерв) — постоянная работа резервной базы данных в режиме ожидания. При сбое происходит мгновенный переход на резерв.
- Warm Spare (тёплый резерв) — резервная база данных, которая активируется за определённое время (например, 5–15 минут). Подходит для систем с высокой нагрузкой.
- Cold Spare (холодный резерв) — база данных, активируемая вручную администратором. Используется для систем с низкой критичностью к времени восстановления.
- HAProxy/LVS — балансировщики нагрузки с автоматическим переключением при сбое. Обеспечивают непрерывную доступность сервиса.

### Задание 2. PostgreSQL
2.1. С помощью официальной документации приведите пример команды резервирования данных и восстановления БД (pgdump/pgrestore).

2.1.* Возможно ли автоматизировать этот процесс? Если да, то как?

Приведите ответ в свободной форме.

### Ответ

### Резервирование БД
pg_dump -U username -d database_name -F c -f backup.dump

https://statuser.cloud/blog/kak-nastroit-avtomaticheskiy-bekap-postgresql

Здесь:

* **-U username** — имя пользователя;
* **-d database_name** — название базы данных;
* **-F c** — архивный формат;
* **-f backup.dump** — имя файла бэкапа.

### Восстановление базы данных

pg_restore -U username -d database_name -c backup.dump

https://www.postgresql.org/docs/current/app-pgrestore.html

2.1.* Возможно ли автоматизировать этот процесс? Если да, то как? Возможно! Путем создания баш-скрипта исполняемого по расписанию. Также можно настроить отправку писем об итоге хода выполнения дампа.

https://habr.com/ru/articles/595641/

### Задание 3. MySQL
3.1. С помощью официальной документации приведите пример команды инкрементного резервного копирования базы данных MySQL.

3.1.* В каких случаях использование реплики будет давать преимущество по сравнению с обычным резервным копированием?

Приведите ответ в свободной форме.

### Ответ
Так как инкрементное резервное копирование использует полную копию как начальную точку, то сначала нужно сделать полную резервную копию. Далее инкрементное резервное копирование:

    mysqlbackup --defaults-file=/home/dbadmin/my.cnf \
  --incremental --incremental-base=history:last_backup \
  --backup-dir=/home/dbadmin/temp_dir \
  --backup-image=incremental_image1.bi \
   backup-to-image

В данном примере используется опция --incremental-base=history:last_backup, которая извлекает LSN последней успешной полной или частичной резервной копии (не TTS) из mysql.backup_history таблицы и на этой основе выполняет инкрементную резервную копию.

Адрес ссылки

 https://dev.mysql.com/doc/mysql-enterprise-backup/8.2/en/mysqlbackup.incremental.html#meb-incremental-considerations
